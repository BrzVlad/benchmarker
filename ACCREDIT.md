# Accredit - A service for getting credentials to services

We use web services to store and present benchmarking results, as well
as to host the benchmarking coordination itself.  To interact with
those services the user, or rather the programs invoked by the user,
require credentials.

We don't want to store those credentials in the program's repository,
because we might want the program itself to be public, apart from
other issues with this approach.  We also would like to avoid having
to ask IT for the credentials.  They are busy enough and this would be
another non-automated hurdle that slows us down.

Accredit solves this problem by using the user's GitHub authentication
to prove their identity and, once proven, provides credentials for
various services.

## Workflow

To initiate a request for credentials, the client - the program,
acting on the user's behalf - does a POST request to

    https://benchmarker.parseapp.com/requestCredentials

It provides three arguments:

  - `service`: The name of the service for which credentials are requested
  - `key`: A random key used to identify this request
  - `secret`: A really, really random secret shared between the client and Accredit

The request will return a `text/plain` document containing the URL of
a GitHub OAuth endpoint which the client then opens in the user's
browser.  The user authorizes the "Xamarin Benchmarker" app on GitHub
and is then redirected back to an Accredit URL that requires an
additional confirmation from the user, asking them to make sure that
this request is done on their behalf, and that the key matches the one
generated by the client.

Once the user acknowledges the request in the browser, an entry in the
`CredentialsResponse` table on Parse is generated:

    curl -X GET \
            -H "X-Parse-Application-Id: 7khPUBga9c7L1YryD1se1bp6VRzKKJESc0baS9ES" \
            -H "X-Parse-REST-API-Key: xOHOwaDls0fcuMKLIH0nzaMKclLzCWllwClLej4d" \
            -G \
            https://api.parse.com/1/classes/CredentialsResponse
    
    {
      "results": [
        {
          "createdAt": "2015-07-16T21:39:08.116Z",
          "key": "e22fe736-b3d7-4630-8213-ae9a36980fd1",
          "objectId": "cqbwUYJTvo",
          "success": true,
          "updatedAt": "2015-07-16T21:39:08.116Z"
        }
      ]
    }

The client queries this table for an entry with `key` being the key it
generated, and once the entry is there and `success` is `true`, it
does a POST request to

    https://benchmarker.parseapp.com/getCredentials

with the arguments

  - `key`: The random key
  - `secret`: The random secret

to finally get the credentials.
